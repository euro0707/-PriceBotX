<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é€šçŸ¥è¨­å®š (ãƒ¡ãƒ¼ãƒ«å°‚ç”¨) | PriceBotX</title>
</head>
<body>
<div style="max-width: 400px; margin: 0 auto; padding: 2rem; border-radius: 8px; background: #f9f9f9;">
  <h2>é€šçŸ¥è¨­å®š</h2>

  <label>é€šçŸ¥å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label><br />
  <input type="email" id="email" placeholder="ä¾‹ï¼‰example@gmail.com" style="width: 100%; padding: 8px;" />

  <div style="margin-top: 1rem;">
    <label>å¸Œæœ›ä¾¡æ ¼</label><br />
    <input type="number" id="target_price" placeholder="ä¾‹ï¼‰3000" style="width: 100%; padding: 8px;" />
  </div>

  <div style="margin-top: 1rem;">
    <label>é€šçŸ¥ON/OFF</label><br />
    <label class="switch">
      <input type="checkbox" id="notify_on" checked />
      <span class="slider round"></span>
    </label>
  </div>

  <button onclick="saveSettings()" style="margin-top: 1.5rem; width: 100%; padding: 10px; background: #4CAF50; color: white; border: none; border-radius: 5px;">ä¿å­˜</button>
</div>

<script>
function saveSettings() {
  const email = document.getElementById("email").value;
  const target_price = parseInt(document.getElementById("target_price").value, 10);
  const notify_on = document.getElementById("notify_on").checked;

  const data = { method: "email", email, target_price, notify_on };
  localStorage.setItem("notification_settings", JSON.stringify(data));
  alert("ä¿å­˜ã—ã¾ã—ãŸ");

  const current_price = 2800; // ä»®ã®ç¾åœ¨ä¾¡æ ¼ï¼ˆå¾Œã«APIå–å¾—ã«ç½®æ›ï¼‰

  if (notify_on && current_price <= target_price) {
    const zapierWebhookUrl = "https://hooks.zapier.com/hooks/catch/23728288/u3chd5w/";
    const payload = {
      email,
      current_price,
      target_price,
      message: `ğŸ“¢ å•†å“ä¾¡æ ¼ãŒä¸‹ãŒã‚Šã¾ã—ãŸï¼\nç¾åœ¨ä¾¡æ ¼: Â¥${current_price}\nå¸Œæœ›ä¾¡æ ¼: Â¥${target_price}`
    };

    fetch(zapierWebhookUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    })
    .then(res => {
      if (res.ok) {
        alert("ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼ˆZapierï¼‰ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼");
      } else {
        alert("é€šçŸ¥ã«å¤±æ•—ã—ã¾ã—ãŸã€‚Zapierã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      }
    })
    .catch(err => {
      console.error("é€šçŸ¥ã‚¨ãƒ©ãƒ¼:", err);
      alert("é€šçŸ¥é€ä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
    });
  }
}
</script>

<style>
.switch { position: relative; display: inline-block; width: 46px; height: 24px; }
.switch input { display: none; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: 0.4s; border-radius: 24px; }
.slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: 0.4s; border-radius: 50%; }
input:checked + .slider { background-color: #4CAF50; }
input:checked + .slider:before { transform: translateX(22px); }
</style>
</body>
</html>
